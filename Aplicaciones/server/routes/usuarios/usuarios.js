var _0x2051=['readFileSync','./server/config.yml','utf-8','unix','add','app','gral','minutes','encode','secret_api_key','alg','setHeader','content-type','application/text;charset=utf-8','status','send','password','query','\x0a\x20\x20SELECT\x20\x20sp.numero_documento\x20as\x20CarnetIdentidad,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20us.tipo\x20as\x20Tipo,\x20us.estado\x20as\x20Estado\x0a\x20\x20FROM\x20servidores_publicos\x20sp\x20INNER\x20JOIN\x20usuarios\x20us\x20ON\x20sp.numero_documento=us.login\x0a\x20\x20WHERE\x20numero_documento=?\x20AND\x20codigo_biometrico=?','credentials_time_minutes','ensureAuthenticated','\x0a\x20\x20\x20\x20UPDATE\x20usuarios\x20SET\x20password=?\x0a\x20\x20\x20\x20WHERE\x20login=?\x20AND\x20password=?','affectedRows','/usuarios/restablecer-credenciales-usuario','tipo','SELECT\x20*\x20FROM\x20usuarios\x20WHERE\x20login=?','\x0a\x20\x20\x20\x20\x20\x20INSERT\x20INTO\x20usuarios(login,password,estado,tipo)\x20VALUES\x20(?,?,1,?)','\x0a\x20\x20\x20\x20\x20\x20UPDATE\x20usuarios\x20SET\x20password=?\x20,\x20estado=1\x20,\x20tipo=?\x0a\x20\x20\x20\x20\x20\x20WHERE\x20login=?','/usuarios/update-estado','estado','usuario','split','/usuarios/recovery-info-authentication','numeroDocumento','get','/usuarios','\x0a\x20\x20SELECT\x20us.*,\x20sp.nombres,sp.apellido_paterno,sp.apellido_materno\x20\x20,\x20sp.numero_documento\x0a\x20\x20\x20FROM\x20usuarios\x20us\x20INNER\x20JOIN\x20servidores_publicos\x20sp\x20ON\x20us.login=sp.numero_documento','/usuarios/add','\x0a\x20\x20INSERT\x20INTO\x20usuarios(login,password,tipo)\x20values\x20(?,?,?)','/usuarios/habilitar-desabilitar-usuario','/usuarios/cambiar-tipo-usuario','\x0a\x20\x20\x20\x20\x20\x20UPDATE\x20usuarios\x20SET\x20tipo=?\x0a\x20\x20\x20\x20\x20\x20WHERE\x20login=?','exports','jwt-simple','moment','../../databaseMysql','js-yaml','post','parse','body','json','login','\x0a\x20\x20SELECT\x20login\x20as\x20CarnetIdentidad,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20tipo\x20as\x20Tipo,\x20estado\x20as\x20Estado\x0a\x20\x20FROM\x20usuarios\x0a\x20\x20WHERE\x20login=?\x20AND\x20password=?','stringify','length','safeLoad'];(function(_0x5102c3,_0xe49201){var _0x1877cc=function(_0x22699a){while(--_0x22699a){_0x5102c3['push'](_0x5102c3['shift']());}};_0x1877cc(++_0xe49201);}(_0x2051,0x10b));var _0x57d4=function(_0x917032,_0x1b79fe){_0x917032=_0x917032-0x0;var _0x15543f=_0x2051[_0x917032];return _0x15543f;};const jwt=require(_0x57d4('0x0'));const moment=require(_0x57d4('0x1'));const express=require('express');const router=express['Router']();const mysqldb=require(_0x57d4('0x2'));const middleware=require('../../middleware');const fs=require('fs');const yaml=require(_0x57d4('0x3'));router[_0x57d4('0x4')]('/usuarios/autenticar',(_0x2e0b79,_0x39c6bc,_0x489063)=>{const _0xfb5398=JSON[_0x57d4('0x5')](_0x2e0b79[_0x57d4('0x6')][_0x57d4('0x7')]);const _0x50d667=_0xfb5398[_0x57d4('0x8')];const _0x137dd7=_0xfb5398['password'];mysqldb['query'](_0x57d4('0x9'),[_0x50d667,_0x137dd7],(_0x27efbf,_0x35f852)=>{if(_0x27efbf){throw _0x27efbf;}_0x35f852=JSON[_0x57d4('0x5')](JSON[_0x57d4('0xa')](_0x35f852));if(_0x35f852[_0x57d4('0xb')]){const _0x1fd6cb=yaml[_0x57d4('0xc')](fs[_0x57d4('0xd')](_0x57d4('0xe'),_0x57d4('0xf')));var _0x385027=JSON[_0x57d4('0x5')](JSON[_0x57d4('0xa')](_0x1fd6cb));const _0x27261b={'sub':_0x50d667,'data':_0x35f852[0x0],'iat':moment()[_0x57d4('0x10')](),'exp':moment()[_0x57d4('0x11')](_0x385027[_0x57d4('0x12')][_0x57d4('0x13')]['credentials_time_minutes'],_0x57d4('0x14'))[_0x57d4('0x10')]()};const _0xfa6641=jwt[_0x57d4('0x15')](_0x27261b,_0x385027[_0x57d4('0x12')][_0x57d4('0x13')][_0x57d4('0x16')],_0x385027['app']['gral'][_0x57d4('0x17')]);_0x39c6bc[_0x57d4('0x18')](_0x57d4('0x19'),_0x57d4('0x1a'));_0x39c6bc[_0x57d4('0x1b')](0xc8)['send'](JSON[_0x57d4('0xa')]({'success':!![],'result':_0xfa6641}));}else{_0x39c6bc[_0x57d4('0x1b')](0xc8)[_0x57d4('0x1c')](JSON[_0x57d4('0xa')]({'success':![]}));}});});router[_0x57d4('0x4')]('/usuarios/autenticar-servidor-publico',(_0x42fa45,_0x160f86,_0x475b19)=>{const _0x23e1e7=JSON[_0x57d4('0x5')](_0x42fa45[_0x57d4('0x6')][_0x57d4('0x7')]);const _0x4c9d1c=_0x23e1e7[_0x57d4('0x8')];const _0x26db3f=_0x23e1e7[_0x57d4('0x1d')];mysqldb[_0x57d4('0x1e')](_0x57d4('0x1f'),[_0x4c9d1c,_0x26db3f],(_0x44d4bf,_0x3c7eda)=>{if(_0x44d4bf){throw _0x44d4bf;}if(_0x3c7eda[_0x57d4('0xb')]){const _0x401aa4=yaml[_0x57d4('0xc')](fs['readFileSync'](_0x57d4('0xe'),_0x57d4('0xf')));var _0x2a4973=JSON[_0x57d4('0x5')](JSON['stringify'](_0x401aa4));const _0x1595dd={'sub':_0x4c9d1c,'data':_0x3c7eda[0x0],'iat':moment()['unix'](),'exp':moment()[_0x57d4('0x11')](_0x2a4973[_0x57d4('0x12')][_0x57d4('0x13')][_0x57d4('0x20')],_0x57d4('0x14'))[_0x57d4('0x10')]()};const _0x2e4653=jwt[_0x57d4('0x15')](_0x1595dd,_0x2a4973[_0x57d4('0x12')][_0x57d4('0x13')][_0x57d4('0x16')],_0x2a4973[_0x57d4('0x12')][_0x57d4('0x13')][_0x57d4('0x17')]);_0x160f86['setHeader']('content-type',_0x57d4('0x1a'));_0x160f86[_0x57d4('0x1b')](0xc8)[_0x57d4('0x1c')](JSON[_0x57d4('0xa')]({'success':!![],'result':_0x2e4653}));}else{_0x160f86[_0x57d4('0x1b')](0xc8)[_0x57d4('0x1c')](JSON[_0x57d4('0xa')]({'success':![]}));}});});router[_0x57d4('0x4')]('/usuarios/update-password',middleware[_0x57d4('0x21')],(_0x23833a,_0x5dae8d,_0x35fc37)=>{const _0x5ba89e=JSON[_0x57d4('0x5')](_0x23833a[_0x57d4('0x6')][_0x57d4('0x7')]);const _0xa76d27=_0x5ba89e[_0x57d4('0x8')];const _0x49d415=_0x5ba89e[_0x57d4('0x1d')];const _0x48309d=_0x5ba89e['newPassword'];mysqldb[_0x57d4('0x1e')](_0x57d4('0x22'),[_0x48309d,_0xa76d27,_0x49d415],function(_0x4c4676,_0x197cc5){if(_0x4c4676)throw _0x4c4676;_0x5dae8d[_0x57d4('0x1b')](0xc8)[_0x57d4('0x1c')](JSON[_0x57d4('0xa')]({'success':_0x197cc5[_0x57d4('0x23')]?!![]:![],'result':_0x197cc5[_0x57d4('0x23')]?!![]:![]}));});});router['post'](_0x57d4('0x24'),middleware[_0x57d4('0x21')],(_0x275cac,_0x32cff6,_0x3c7063)=>{const _0x2a8992=JSON[_0x57d4('0x5')](_0x275cac[_0x57d4('0x6')][_0x57d4('0x7')]),_0x5129b0=_0x2a8992[_0x57d4('0x8')],_0x33d1cc=_0x2a8992[_0x57d4('0x1d')],_0x4a9be3=_0x2a8992[_0x57d4('0x25')];mysqldb[_0x57d4('0x1e')](_0x57d4('0x26'),[_0x5129b0],(_0x1f5838,_0x5c3a32)=>{if(_0x1f5838)throw _0x1f5838;if(!_0x5c3a32[_0x57d4('0xb')]){mysqldb['query'](_0x57d4('0x27'),[_0x5129b0,_0x33d1cc,_0x4a9be3],function(_0xc75386,_0x5cfa57){if(_0xc75386)throw _0xc75386;_0x32cff6[_0x57d4('0x1b')](0xc8)['send'](JSON[_0x57d4('0xa')]({'success':_0x5cfa57['affectedRows']?!![]:![],'result':_0x5cfa57[_0x57d4('0x23')]?!![]:![]}));});}else{mysqldb['query'](_0x57d4('0x28'),[_0x33d1cc,_0x4a9be3,_0x5129b0],function(_0x40ae50,_0x48f1b9){if(_0x40ae50)throw _0x40ae50;_0x32cff6[_0x57d4('0x1b')](0xc8)[_0x57d4('0x1c')](JSON[_0x57d4('0xa')]({'success':_0x48f1b9['affectedRows']?!![]:![],'result':_0x48f1b9[_0x57d4('0x23')]?!![]:![]}));});}});});router['post'](_0x57d4('0x29'),middleware['ensureAuthenticated'],(_0x56b0e5,_0x59c4d7,_0x2fb282)=>{let _0xcf14ba=JSON['parse'](_0x56b0e5[_0x57d4('0x6')]['json']);let _0x191ad8=_0xcf14ba[_0x57d4('0x2a')];let _0x5ce309=_0xcf14ba[_0x57d4('0x2b')]['toString']()[_0x57d4('0x2c')]('\x20')[0x0];mysqldb['query']('UPDATE\x20usuarios\x20set\x20estado=?\x20where\x20login=?\x0a\x20\x20\x20\x20',[_0x191ad8,_0x5ce309],(_0x5d8b69,_0x5498ec,_0x585644)=>{if(_0x5d8b69){throw _0x5d8b69;}_0x59c4d7['status'](0xc8)['send']({'success':_0x5498ec[_0x57d4('0x23')]?!![]:![],'result':_0x5498ec});});});router[_0x57d4('0x4')](_0x57d4('0x2d'),(_0x5dbf79,_0x5323bc,_0x33b058)=>{const _0x4af229=JSON[_0x57d4('0x5')](_0x5dbf79[_0x57d4('0x6')][_0x57d4('0x7')]);const _0x253464=_0x4af229[_0x57d4('0x2e')];mysqldb[_0x57d4('0x1e')]('\x0a\x20\x20SELECT\x20nombres,apellido_paterno,apellido_materno,\x0a\x20\x20correo_electronico\x20,codigo_biometrico\x20FROM\x20servidores_publicos\x0a\x20\x20WHERE\x20numero_documento=?',[_0x253464],(_0x2f7da6,_0x2732bf)=>{if(_0x2f7da6)throw _0x2f7da6;_0x5323bc['status'](0xc8)[_0x57d4('0x1c')]({'success':_0x2732bf,'result':_0x2732bf});});});router[_0x57d4('0x2f')](_0x57d4('0x30'),middleware['ensureAuthenticated'],(_0x5e8cde,_0x5499f9,_0x1cf3f6)=>{mysqldb[_0x57d4('0x1e')](_0x57d4('0x31'),function(_0x3536d4,_0x271cc3){if(_0x3536d4)throw _0x3536d4;_0x5499f9[_0x57d4('0x1b')](0xc8)['send']({'success':_0x271cc3[_0x57d4('0xb')]?!![]:![],'result':_0x271cc3});});});router['post'](_0x57d4('0x32'),(_0x499225,_0x4e7da3,_0x46c595)=>{const _0xb1c3a8=JSON[_0x57d4('0x5')](_0x499225['body']['json']);const _0x290a4d=_0xb1c3a8[_0x57d4('0x8')];const _0x376e2a=_0xb1c3a8[_0x57d4('0x1d')];const _0x401ced=_0xb1c3a8['tipo'];mysqldb[_0x57d4('0x1e')](_0x57d4('0x33'),[_0x290a4d,_0x376e2a,_0x401ced],(_0x5e4af1,_0x33145e)=>{if(_0x5e4af1)throw _0x5e4af1;_0x4e7da3['status'](0xc8)['send']({'success':_0x33145e[_0x57d4('0x23')]?!![]:![],'result':_0x33145e});});});router[_0x57d4('0x4')]('/usuarios/delete',(_0x52dc4b,_0x31176c,_0x9f2467)=>{const _0x2f739a=JSON[_0x57d4('0x5')](_0x52dc4b[_0x57d4('0x6')][_0x57d4('0x7')]);const _0x3a0eb4=_0x2f739a[_0x57d4('0x8')];const _0x4f370f=_0x2f739a[_0x57d4('0x25')];mysqldb[_0x57d4('0x1e')]('\x0a\x20\x20DELETE\x20FROM\x20usuarios\x20WHERE\x20login=?\x20AND\x20tipo=?',[_0x3a0eb4,_0x4f370f],(_0x5a4003,_0x1537f3)=>{if(_0x5a4003)throw _0x5a4003;_0x31176c[_0x57d4('0x1b')](0xc8)[_0x57d4('0x1c')]({'success':_0x1537f3[_0x57d4('0x23')]?!![]:![],'result':_0x1537f3});});});router[_0x57d4('0x4')](_0x57d4('0x34'),middleware[_0x57d4('0x21')],(_0x5ecbfa,_0x652356,_0x4aa8b2)=>{const _0x26102d=JSON[_0x57d4('0x5')](_0x5ecbfa['body'][_0x57d4('0x7')]),_0x5c0122=_0x26102d[_0x57d4('0x8')],_0x2a60bc=!_0x26102d['estado'];mysqldb[_0x57d4('0x1e')]('\x0a\x20\x20\x20\x20\x20\x20UPDATE\x20usuarios\x20SET\x20estado=?\x0a\x20\x20\x20\x20\x20\x20WHERE\x20login=?',[_0x2a60bc,_0x5c0122],function(_0x577d55,_0x5cc371){if(_0x577d55)throw _0x577d55;_0x652356['status'](0xc8)[_0x57d4('0x1c')](JSON[_0x57d4('0xa')]({'success':_0x5cc371[_0x57d4('0x23')]?!![]:![],'result':_0x5cc371[_0x57d4('0x23')]?!![]:![]}));});});router['post'](_0x57d4('0x35'),middleware[_0x57d4('0x21')],(_0x547478,_0x2e0206,_0x293fe9)=>{const _0x3f4a9f=JSON[_0x57d4('0x5')](_0x547478[_0x57d4('0x6')][_0x57d4('0x7')]),_0x9227f6=_0x3f4a9f['login'],_0x2073f1=_0x3f4a9f[_0x57d4('0x25')];mysqldb['query'](_0x57d4('0x36'),[_0x2073f1,_0x9227f6],function(_0x424c04,_0x3acc8d){if(_0x424c04)throw _0x424c04;_0x2e0206[_0x57d4('0x1b')](0xc8)[_0x57d4('0x1c')]({'success':_0x3acc8d['affectedRows']?!![]:![],'result':_0x3acc8d});});});module[_0x57d4('0x37')]=router;